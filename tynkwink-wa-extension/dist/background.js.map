{
  "version": 3,
  "sources": ["../src/common/storage.ts", "../src/background.ts"],
  "sourcesContent": ["import type { AuthState } from \"./types\";\r\n\r\nconst KEY = \"tynkwink_auth_v1\";\r\n\r\nexport async function saveAuth(auth: AuthState) {\r\n  await chrome.storage.local.set({ [KEY]: auth });\r\n}\r\n\r\nexport async function getAuth(): Promise<AuthState> {\r\n  const res = await chrome.storage.local.get([KEY]);\r\n  const auth = res[KEY] as AuthState | undefined;\r\n\r\n  return {\r\n    apiBase: auth?.apiBase ?? null,\r\n    token: auth?.token ?? null,\r\n    tenantId: auth?.tenantId ?? null\r\n  };\r\n}\r\n", "import type { BgMessage } from \"./common/types\";\r\nimport { getAuth, saveAuth } from \"./common/storage\";\r\n\r\nchrome.runtime.onMessage.addListener((message: BgMessage, _sender, sendResponse) => {\r\n  (async () => {\r\n    try {\r\n      if (message.type === \"AUTH_SAVE\") {\r\n        // Basic normalization\r\n        const apiBase = (message.auth.apiBase ?? \"\").trim().replace(/\\/+$/, \"\");\r\n        const token = (message.auth.token ?? \"\").trim();\r\n        const tenantId = (message.auth.tenantId ?? \"\").trim();\r\n\r\n        await saveAuth({\r\n          apiBase: apiBase || null,\r\n          token: token || null,\r\n          tenantId: tenantId || null\r\n        });\r\n\r\n        sendResponse({ ok: true });\r\n        return;\r\n      }\r\n\r\n      if (message.type === \"AUTH_GET\") {\r\n        const auth = await getAuth();\r\n        sendResponse({ ok: true, auth });\r\n        return;\r\n      }\r\n\r\n      if (message.type === \"SYNC_CHAT\") {\r\n        const auth = await getAuth();\r\n        if (!auth.apiBase || !auth.token || !auth.tenantId) {\r\n          sendResponse({ ok: false, error: \"Not authenticated. Open extension popup and set API Base, Tenant ID, Token.\" });\r\n          return;\r\n        }\r\n\r\n        // CHANGE HERE: Your backend route path\r\n        const url = `${auth.apiBase}/api/integrations/whatsapp-web/sync`;\r\n\r\n        const resp = await fetch(url, {\r\n          method: \"POST\",\r\n          headers: {\r\n            \"Content-Type\": \"application/json\",\r\n            \"Authorization\": `Bearer ${auth.token}`\r\n          },\r\n          body: JSON.stringify({\r\n            tenantId: auth.tenantId, // backend should override/verify against token claims\r\n            ...message.payload\r\n          })\r\n        });\r\n\r\n        const data = await resp.json().catch(() => ({}));\r\n        if (!resp.ok) {\r\n          sendResponse({\r\n            ok: false,\r\n            error: data?.message || \"Sync failed\",\r\n            status: resp.status,\r\n            data\r\n          });\r\n          return;\r\n        }\r\n\r\n        sendResponse({ ok: true, data });\r\n        return;\r\n      }\r\n\r\n      sendResponse({ ok: false, error: \"Unknown message type\" });\r\n    } catch (e: any) {\r\n      sendResponse({ ok: false, error: e?.message || \"Unexpected error\" });\r\n    }\r\n  })();\r\n\r\n  // Required for async response\r\n  return true;\r\n});\r\n"],
  "mappings": ";AAEA,IAAM,MAAM;AAEZ,eAAsB,SAAS,MAAiB;AAC9C,QAAM,OAAO,QAAQ,MAAM,IAAI,EAAE,CAAC,GAAG,GAAG,KAAK,CAAC;AAChD;AAEA,eAAsB,UAA8B;AAClD,QAAM,MAAM,MAAM,OAAO,QAAQ,MAAM,IAAI,CAAC,GAAG,CAAC;AAChD,QAAM,OAAO,IAAI,GAAG;AAEpB,SAAO;AAAA,IACL,SAAS,MAAM,WAAW;AAAA,IAC1B,OAAO,MAAM,SAAS;AAAA,IACtB,UAAU,MAAM,YAAY;AAAA,EAC9B;AACF;;;ACdA,OAAO,QAAQ,UAAU,YAAY,CAAC,SAAoB,SAAS,iBAAiB;AAClF,GAAC,YAAY;AACX,QAAI;AACF,UAAI,QAAQ,SAAS,aAAa;AAEhC,cAAM,WAAW,QAAQ,KAAK,WAAW,IAAI,KAAK,EAAE,QAAQ,QAAQ,EAAE;AACtE,cAAM,SAAS,QAAQ,KAAK,SAAS,IAAI,KAAK;AAC9C,cAAM,YAAY,QAAQ,KAAK,YAAY,IAAI,KAAK;AAEpD,cAAM,SAAS;AAAA,UACb,SAAS,WAAW;AAAA,UACpB,OAAO,SAAS;AAAA,UAChB,UAAU,YAAY;AAAA,QACxB,CAAC;AAED,qBAAa,EAAE,IAAI,KAAK,CAAC;AACzB;AAAA,MACF;AAEA,UAAI,QAAQ,SAAS,YAAY;AAC/B,cAAM,OAAO,MAAM,QAAQ;AAC3B,qBAAa,EAAE,IAAI,MAAM,KAAK,CAAC;AAC/B;AAAA,MACF;AAEA,UAAI,QAAQ,SAAS,aAAa;AAChC,cAAM,OAAO,MAAM,QAAQ;AAC3B,YAAI,CAAC,KAAK,WAAW,CAAC,KAAK,SAAS,CAAC,KAAK,UAAU;AAClD,uBAAa,EAAE,IAAI,OAAO,OAAO,8EAA8E,CAAC;AAChH;AAAA,QACF;AAGA,cAAM,MAAM,GAAG,KAAK,OAAO;AAE3B,cAAM,OAAO,MAAM,MAAM,KAAK;AAAA,UAC5B,QAAQ;AAAA,UACR,SAAS;AAAA,YACP,gBAAgB;AAAA,YAChB,iBAAiB,UAAU,KAAK,KAAK;AAAA,UACvC;AAAA,UACA,MAAM,KAAK,UAAU;AAAA,YACnB,UAAU,KAAK;AAAA;AAAA,YACf,GAAG,QAAQ;AAAA,UACb,CAAC;AAAA,QACH,CAAC;AAED,cAAM,OAAO,MAAM,KAAK,KAAK,EAAE,MAAM,OAAO,CAAC,EAAE;AAC/C,YAAI,CAAC,KAAK,IAAI;AACZ,uBAAa;AAAA,YACX,IAAI;AAAA,YACJ,OAAO,MAAM,WAAW;AAAA,YACxB,QAAQ,KAAK;AAAA,YACb;AAAA,UACF,CAAC;AACD;AAAA,QACF;AAEA,qBAAa,EAAE,IAAI,MAAM,KAAK,CAAC;AAC/B;AAAA,MACF;AAEA,mBAAa,EAAE,IAAI,OAAO,OAAO,uBAAuB,CAAC;AAAA,IAC3D,SAAS,GAAQ;AACf,mBAAa,EAAE,IAAI,OAAO,OAAO,GAAG,WAAW,mBAAmB,CAAC;AAAA,IACrE;AAAA,EACF,GAAG;AAGH,SAAO;AACT,CAAC;",
  "names": []
}
